<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatTheFlah</title>
    <style>
        html {
            text-align: center;
            background-color: #444;
            font-family: cursive;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        section {
            padding: 10px;
            background-color: #fff59a;
            width: 95%;
            max-width: 400px;
            margin: auto;
            border-radius: 10px;
        }

        #opcoes1,
        #opcoes2,
        #opcoes3 {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }

        .band {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 25%;
            border: 1px solid #000;
            box-sizing: content-box;
            background: linear-gradient(#fff, #999, #000);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
        }

        .band img {
            max-width: 100%;
        }

        .band div {
            margin-top: 5px;
            color: #fff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        #initpage,
        #firstsec,
        #secondsec,
        #thirdsec,
        #lastsec {
            display: none;
        }

        #initpage {
            display: block;
        }

        #tempo,
        #score {
            padding: 20px;
            font-size: 30px;
            font-weight: 600;
            color: #fff;
        }

        button {
            border: none;
            padding: 5% 10%;
            background: linear-gradient(360deg, #7dfdf7, #6bf5c0, #fff);
            font-size: 20px;
            font-weight: 600;
            border-radius: 15px;
            box-shadow: 0 0 15px #2f5c5a;
            background-color: rgba(20, 102, 0, 0.5);
        }
    </style>
</head>

<body id="body">
    <main>
        <div id="tempo">00:<span id="timer">30</span></div>

        <section id="initpage">
            <h1>Bem-vindo ao WhatTheFlah!</h1>
            <button onclick="iniciar()">Iniciar</button>
        </section>

        <section id="firstsec">
            <h1 id="pergunta1">País que falam espanhol?</h1>
            <div id="opcoes1">
                <!-- Divs geradas dinamicamente -->
            </div>
        </section>

        <section id="secondsec">
            <h1 id="pergunta2">País que pertencem ao Continente da America?</h1>
            <div id="opcoes2">
                <!-- Divs geradas dinamicamente -->
            </div>
        </section>

        <section id="thirdsec">
            <h1 id="pergunta3">País que utilizam Dólar, Euro, ou Real?</h1>
            <div id="opcoes3">
                <!-- Divs geradas dinamicamente -->
            </div>
        </section>

        <section id="lastsec">
            <h1>Fim do Jogo!</h1>
            <h1 id="texto_final"></h1>
            <div style="display: flex; gap: 2px;">
                <button id="iniciar" onclick="iniciar()">Iniciar Novamente</button>
                <button id="resetscore" onclick="resetscore()">Resetar Score</button>
            </div>

        </section>
        <div id="score">Acertos: <span id="acertos">0</span>/3</div>

    </main>

    <script>
        const img_name = [
            "001-chile.png",
            "002-ireland.png",
            "003-greece.png",
            "004-norway.png",
            "005-israel.png",
            "006-guatemala.png",
            "007-cuba.png",
            "008-croatia.png",
            "009-panama.png",
            "010-south africa.png",
            "011-iran.png",
            "012-egypt.png",
            "013-morocco.png",
            "014-denmark.png",
            "015-czech republic.png",
            "016-finland.png",
            "017-sweden.png",
            "018-philippines.png",
            "019-england.png",
            "020-switzerland.png",
            "021-turkey.png",
            "022-portugal.png",
            "023-united kingdom.png",
            "024-colombia.png",
            "025-argentina.png",
            "026-india.png",
            "027-united states of america.png",
            "028-thailand.png",
            "029-canada.png",
            "030-mexico.png",
            "031-italy.png",
            "032-spain.png",
            "033-china.png",
            "034-uruguay.png",
            "035-germany.png",
            "036-france.png",
            "037-japan.png",
            "038-south korea.png",
            "039-north korea.png",
            "040-saudi arabia.png",
            "041-honduras.png",
            "042-curacao.png",
            "043-equatorial guinea.png",
            "044-libya.png",
            "045-sudan.png",
            "046-turkmenistan.png",
            "047-togo.png",
            "048-somalia.png",
            "049-mauritius.png",
            "050-montenegro.png"
        ];
        const falam_espanhol = [
            "chile",
            "guatemala",
            "cuba",
            "panama",
            "colombia",
            "argentina",
            "mexico",
            "spain",
            "uruguay",
            "honduras"
        ];
        const paises_america = [
            "chile",
            "guatemala",
            "cuba",
            "panama",
            "colombia",
            "argentina",
            "united states of america",
            "canada",
            "mexico",
            "uruguay",
            "honduras",
            "curacao"
        ];
        const paises_com_dolar_real_euro = [
            "chile", "panama", "argentina", "united states of america",
            "canada", "mexico", "uruguay", "curacao",
            "ireland", "greece", "italy", "spain", "france", "germany", "portugal",
            "switzerland", "denmark", "finland", "sweden", "england", "united kingdom"
        ];
        const initpage = document.getElementById("initpage");
        const firstsec = document.getElementById("firstsec");
        const secondsec = document.getElementById("secondsec");
        const thirdsec = document.getElementById("thirdsec");
        const lastsec = document.getElementById("lastsec");
        const opcoes1 = document.getElementById("opcoes1");
        const opcoes2 = document.getElementById("opcoes2");
        const opcoes3 = document.getElementById("opcoes3");

        const somAcerto = new Audio("src/acerto.mp3")
        const somVitoria = new Audio("src/win.mp3")
        const somClique = new Audio("src/som.mp3")
        let game_ativo = true
        let acertos = document.getElementById("acertos");



        document.getElementById("body").addEventListener("click", function () {
            somClique.play();
        })

        firstsec.addEventListener("click", function (evt) {
            if (firstsec.getAttribute("data-locked") === "true") return;
            firstsec.setAttribute("data-locked", "true");
            if (falam_espanhol.includes(evt.target.alt)) {
                acertos.innerText = parseInt(acertos.innerText) + 1;
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, green)";
                somAcerto.play();
                setTimeout(() => {

                    segunda_pag()
                    firstsec.setAttribute("data-locked", "false");
                }, 2000);
            } else {
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, red)"
                certo_errado(opcoes1)
                setTimeout(() => {
                    segunda_pag()
                    firstsec.setAttribute("data-locked", "false");
                }, 2000);
            }
        })

        secondsec.addEventListener("click", function (evt) {
            if (secondsec.getAttribute("data-locked") === "true") return;
            secondsec.setAttribute("data-locked", "true");
            if (paises_america.includes(evt.target.alt)) {
                acertos.innerText = parseInt(acertos.innerText) + 1;
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, green)";
                somAcerto.play();
                setTimeout(() => {
                    terceira_pag();
                    secondsec.setAttribute("data-locked", "false");
                }, 2000);
            } else {
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, red)"
                certo_errado(opcoes2)
                setTimeout(() => {
                    terceira_pag()
                    secondsec.setAttribute("data-locked", "false");
                }, 2000);
            }
        })

        thirdsec.addEventListener("click", function (evt) {
            if (thirdsec.getAttribute("data-locked") === "true") return;
            thirdsec.setAttribute("data-locked", "true");
            if (paises_com_dolar_real_euro.includes(evt.target.alt)) {
                acertos.innerText = parseInt(acertos.innerText) + 1;
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, green)";
                somAcerto.play();
                setTimeout(() => {
                    ultima_pag()
                    thirdsec.setAttribute("data-locked", "false");
                }, 2000);
            } else {
                evt.target.closest(".band").style.background = "linear-gradient(#fff, #999, red)"
                certo_errado(opcoes3);
                setTimeout(() => {
                    ultima_pag()
                    thirdsec.setAttribute("data-locked", "false");
                }, 2000);
            }
        });
        
        function  resetscore () {
            acertos.innerText = "0"
        }

        function certo_errado(pergunta) {
            console.log(pergunta);
            let pergunta_resposta = {
                opcoes1: falam_espanhol,
                opcoes2: paises_america,
                opcoes3: paises_com_dolar_real_euro,
            }
            console.log(pergunta.id)
            for (let b of pergunta_resposta[pergunta.id]) { // Itera pelos valores da lista
                const elementos = pergunta.querySelectorAll(`[alt="${b}"]`); // Seleciona elementos com o atributo `alt` correspondente
                elementos.forEach(el => {

                    el.closest(".band").style.background = "linear-gradient(#fff, #999, rgba(20, 100, 90, .8))";
                    console.log(el); // Exibe os elementos encontrados
                });
            }
        }

        function temporizador() {
            let timer = Date.now() + 20000
            let intervalo = setInterval(myTimer, 1000)

            function myTimer() {
                if (game_ativo) {
                    const d = ((timer - Date.now()) / 1000)
                    // console.log(d)
                    if (d >= 0) {
                        if (d < 10) {
                            // console.log("0" + d.toFixed().toString())
                            document.getElementById("timer").innerHTML = `0${d.toFixed().toString()}`;
                        } else {
                            document.getElementById("timer").innerHTML = d.toFixed()
                        }
                    } else {
                        clearInterval(intervalo)
                        alert("Seu tempo esgotou!!!");
                        document.getElementById("timer").innerHTML = "00"
                        reset_section()
                        ultima_pag();

                    }
                } else {
                    clearInterval(intervalo)
                }
            }
        }

        function reset_section() {
            initpage.style.display = "none";
            firstsec.style.display = "none";
            secondsec.style.display = "none";
            thirdsec.style.display = "none";
            lastsec.style.display = "none";
            opcoes1.innerHTML = "";
            opcoes2.innerHTML = "";
            opcoes3.innerHTML = "";
        }

        function iniciar() {
            game_ativo = true
            temporizador();
            reset_section();
            firstsec.style.display = "block";

            opcoes1.innerHTML = ""; // Limpa o conteúdo antes de popular
            cria_bandeira("opcoes1");
        };

        function segunda_pag() {
            reset_section();
            secondsec.style.display = "block";
            opcoes2.innerHTML = "";
            cria_bandeira("opcoes2");
        };

        function terceira_pag() {
            reset_section();
            thirdsec.style.display = "block";
            opcoes3.innerHTML = "";
            cria_bandeira("opcoes3");
        };

        function ultima_pag() {
            let texto_final = document.getElementById("texto_final")
            reset_section();
            game_ativo = false
            lastsec.style.display = "block";
            if (parseInt(acertos.innerText) >= 3) {
                somVitoria.play();
            }
            texto_final.innerText = `Você acertou ${acertos.innerText} de 3`;
        };

        function cria_bandeira(elemento_id) {
            let elemento_atual = document.getElementById(elemento_id)
            for (let i = 1; i <= 9; i++) {
                const numeroAleatorio = Math.floor(Math.random() * img_name.length);
                const nomeArquivo = img_name[numeroAleatorio];
                const nomePais = nomeArquivo.replace(/^\d+-/, '').replace(/\.[^/.]+$/, '');

                const divAtual = document.createElement("div");

                const img = document.createElement("img");
                img.src = `src/images/${nomeArquivo}`;
                img.alt = nomePais;
                divAtual.className = "band";

                const nome = document.createElement("div");
                nome.innerText = nomePais.toUpperCase();

                divAtual.appendChild(img);
                divAtual.appendChild(nome);
                elemento_atual.appendChild(divAtual);
            }
            return
        }
    </script>
</body>

</html>